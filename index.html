<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sorteo Red Pilar</title>
    <style>
        /* --- ESTILOS GENERALES (TEMA PREDETERMINADO) --- */
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f2f5;
            color: #333;
            margin: 0;
            padding: 20px;
            transition: background-color 0.5s ease, color 0.5s ease;
        }
        .container {
            max-width: 600px;
            margin: auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
            transition: background-color 0.5s ease, box-shadow 0.5s ease, border 0.5s ease;
        }
        .logo-container {
            text-align: center;
            margin-bottom: 20px;
        }
        .logo {
            width: 150px;
            height: auto;
        }
        h1 {
            color: #4CAF50;
            text-align: center;
            transition: color 0.5s ease;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            transition: color 0.5s ease;
        }
        input[type="text"] {
            width: calc(100% - 22px);
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
            transition: border-color 0.5s ease, background-color 0.5s ease, color 0.5s ease;
        }
        #numbers-container {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 5px;
            margin-top: 10px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            max-height: 250px;
            overflow-y: auto;
            transition: border-color 0.5s ease, background-color 0.5s ease;
        }
        .number-box {
            background-color: #e9e9e9;
            text-align: center;
            padding: 8px 0;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s, color 0.2s, border 0.2s ease;
            font-size: 14px;
            font-weight: bold;
        }
        .number-box:hover {
            background-color: #ddd;
        }
        .number-box.selected {
            background-color: #4CAF50;
            color: #fff;
            transform: scale(1.05);
        }
        .number-box.assigned {
            background-color: #ccc;
            text-decoration: line-through;
            color: #777;
            cursor: not-allowed;
        }
        .button-group, .add-numbers-group, #theme-toggle-group, .range-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        .add-numbers-group, .range-buttons {
            margin-top: 10px;
        }
        .range-buttons button {
            flex-grow: 1;
            margin-right: 5px;
        }
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            color: #fff;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.2s;
            flex-grow: 1;
            margin: 0 5px;
        }
        button:first-child { margin-left: 0; }
        button:last-child { margin-right: 0; }
        #add-button { background-color: #4CAF50; }
        #add-button:hover { background-color: #45a049; }
        #clear-button { background-color: #f44336; }
        #clear-button:hover { background-color: #da190b; }
        #sorteo-button { background-color: #007BFF; }
        #sorteo-button:hover { background-color: #0056b3; }
        .add-numbers-group button, .range-buttons button { background-color: #17a2b8; }
        .add-numbers-group button:hover, .range-buttons button:hover { background-color: #138496; }
        #results-container, #history-container {
            margin-top: 30px;
            padding: 15px;
            background-color: #fff;
            border-radius: 8px;
            border: 1px solid #eee;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
            transition: background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease;
        }
        .person-entry, .history-entry {
            border-bottom: 1px solid #eee;
            padding: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: border-color 0.5s ease;
        }
        .person-entry:last-child, .history-entry:last-child {
            border-bottom: none;
        }
        .person-info {
            flex-grow: 1;
        }
        .person-name {
            font-weight: bold;
            color: #007BFF;
            margin-bottom: 5px;
            transition: color 0.5s ease;
        }
        .person-numbers {
            font-size: 14px;
        }
        .person-actions {
            margin-left: 10px;
        }
        .action-button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2em;
            margin-left: 5px;
            color: #777;
            transition: color 0.2s;
        }
        .action-button:hover {
            color: #000;
        }
        .edit-mode .person-info, .edit-mode .person-actions {
            flex-direction: column;
            align-items: flex-start;
        }
        .edit-mode .person-info {
            width: 100%;
        }
        .edit-mode .person-name {
            margin-bottom: 10px;
        }
        .edit-mode .person-actions {
            margin-top: 10px;
            display: flex;
            justify-content: flex-end;
            width: 100%;
        }
        .edit-mode .person-actions button {
            margin-left: 10px;
        }
        .edit-mode .person-numbers-list {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 5px;
        }
        .edit-mode .person-number-chip {
            background-color: #e9e9e9;
            padding: 5px 8px;
            border-radius: 12px;
            display: flex;
            align-items: center;
        }
        .edit-mode .person-number-chip button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1em;
            color: #f44336;
            margin-left: 5px;
            padding: 0;
        }
        .edit-mode .person-number-chip button:hover {
            color: #da190b;
        }
        /* ESTILOS DEL BOTÓN ACTUALIZADO EN MODO EDICIÓN */
        .edit-mode #add-number-btn { background-color: #007BFF; }
        .edit-mode #add-number-btn:hover { background-color: #0056b3; }
        .edit-mode #update-name-btn { background-color: #4CAF50; color: #fff; }
        .edit-mode #update-name-btn:hover { background-color: #45a049; }
        #ganador-container {
            margin-top: 20px;
            text-align: center;
            position: relative;
        }
        #ganador-container h2 {
            color: #ffc107;
            transition: color 0.5s ease;
        }
        #ganador-nombre, #ganador-numero {
            font-size: 2em;
            font-weight: bold;
            color: #007BFF;
            transition: transform 0.5s ease-in-out, color 0.5s ease;
            min-height: 1.5em;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #ganador-numero {
            color: #4CAF50;
            margin-bottom: 10px;
            transition: color 0.5s ease;
        }
        .sorteo-running {
            animation: spin 0.025s linear infinite;
        }
        .ganador-zoom {
            animation: winnerZoom 1s ease-in-out;
        }
        @keyframes winnerZoom {
            0% { transform: scale(0.5); opacity: 0; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); }
        }
        #countdown-timer {
            font-size: 3em;
            font-weight: bold;
            color: #f44336;
            margin-top: 20px;
            transition: color 0.5s ease;
        }
        .confetti {
            width: 10px;
            height: 10px;
            background-color: #f06;
            position: absolute;
            top: -10px;
            border-radius: 50%;
            z-index: 1;
        }
        @keyframes fall {
            to {
                top: 105%;
                transform: translate(-50%, 0) rotateZ(360deg);
                opacity: 0;
            }
        }
        
        /* --- ESTILOS TEMA COSMIC --- */
        body.cosmic-theme {
            background: #00001a;
            color: #e0e0ff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .container.cosmic-theme {
            background-color: #1a0033;
            box-shadow: 0 0 20px rgba(70, 0, 100, 0.8), inset 0 0 10px rgba(100, 0, 150, 0.5);
            border: 2px solid #5d00a0;
        }
        .cosmic-theme h1 {
            color: #d495ff;
            text-shadow: 0 0 5px #ff00ff, 0 0 10px #ff00ff;
        }
        .cosmic-theme label {
            color: #b3a0d3;
        }
        .cosmic-theme input[type="text"] {
            background-color: #220044;
            color: #a0d4ff;
            border-color: #4b0082;
            box-shadow: inset 0 0 5px rgba(160, 212, 255, 0.5);
        }
        .cosmic-theme #numbers-container {
            background-color: #220044;
            border-color: #4b0082;
            box-shadow: inset 0 0 10px rgba(160, 212, 255, 0.3);
        }
        .cosmic-theme .number-box {
            background-color: #330066;
            color: #e0e0ff;
            border: 1px solid #5d00a0;
        }
        .cosmic-theme .number-box:hover {
            background-color: #5d00a0;
            color: #fff;
            box-shadow: 0 0 5px #d495ff;
        }
        .cosmic-theme .number-box.selected {
            background-color: #8a2be2;
            color: #fff;
            box-shadow: 0 0 10px #ff00ff;
        }
        .cosmic-theme .number-box.assigned {
            background-color: #330044;
            color: #663399;
            text-decoration-color: #9966cc;
        }
        .cosmic-theme #add-button { background-color: #483d8b; }
        .cosmic-theme #add-button:hover { background-color: #6a5acd; }
        .cosmic-theme #sorteo-button { background-color: #d495ff; color: #000; }
        .cosmic-theme #sorteo-button:hover { background-color: #b56eff; }
        .cosmic-theme #clear-button { background-color: #e30022; }
        .cosmic-theme #clear-button:hover { background-color: #a30019; }
        .cosmic-theme .add-numbers-group button, .cosmic-theme .range-buttons button { background-color: #00aaff; }
        .cosmic-theme .add-numbers-group button:hover, .cosmic-theme .range-buttons button:hover { background-color: #0077cc; }
        .cosmic-theme #results-container, .cosmic-theme #history-container {
            background-color: #220044;
            border-color: #4b0082;
            box-shadow: inset 0 0 10px rgba(160, 212, 255, 0.3);
        }
        .cosmic-theme .person-entry, .cosmic-theme .history-entry {
            border-bottom: 1px solid #5d00a0;
        }
        .cosmic-theme .person-name {
            color: #a0d4ff;
        }
        .cosmic-theme .action-button {
            color: #b3a0d3;
        }
        .cosmic-theme .action-button:hover {
            color: #fff;
        }
        .cosmic-theme .edit-mode input[type="text"] {
            background-color: #330066;
            color: #a0d4ff;
            border-color: #5d00a0;
        }
        .cosmic-theme .edit-mode .person-number-chip {
            background-color: #5d00a0;
            color: #e0e0ff;
        }
        .cosmic-theme .edit-mode .person-number-chip button {
            color: #d495ff;
        }
        .cosmic-theme .edit-mode #add-number-btn { background-color: #00aaff; color: #fff; }
        .cosmic-theme .edit-mode #add-number-btn:hover { background-color: #0077cc; }
        .cosmic-theme .edit-mode #update-name-btn { background-color: #483d8b; color: #fff; }
        .cosmic-theme .edit-mode #update-name-btn:hover { background-color: #6a5acd; }
        .cosmic-theme #ganador-container h2 {
            color: #d495ff;
            text-shadow: 0 0 10px #ff00ff;
        }
        .cosmic-theme #ganador-nombre {
            color: #a0d4ff;
            text-shadow: 0 0 10px #a0d4ff;
        }
        .cosmic-theme #ganador-numero {
            color: #ff00ff;
            text-shadow: 0 0 10px #ff00ff;
        }
        .cosmic-theme #countdown-timer {
            color: #f44336;
        }
        /* --- ESTILOS TEMA NEON PARTY --- */
        body.neon-theme {
            background-color: #0a0a1a;
            color: #f0f0f0;
            font-family: 'Consolas', 'Courier New', monospace;
        }
        .container.neon-theme {
            background-color: #1a1a2a;
            box-shadow: 0 0 20px 5px rgba(100, 255, 255, 0.4);
            border: 1px solid #64ffda;
        }
        .neon-theme h1 {
            color: #ff00ff;
            text-shadow: 0 0 10px #ff00ff, 0 0 20px #ff00ff;
            font-family: 'Consolas', 'Courier New', monospace;
        }
        .neon-theme label {
            color: #f0f0f0;
        }
        .neon-theme input[type="text"] {
            background-color: #333344;
            color: #64ffda;
            border: 1px solid #64ffda;
            box-shadow: 0 0 5px #64ffda;
        }
        .neon-theme #numbers-container {
            background-color: #1a1a2a;
            border: 1px solid #64ffda;
            box-shadow: inset 0 0 5px #64ffda;
        }
        .neon-theme .number-box {
            background-color: #333344;
            color: #64ffda;
            border: 1px solid #64ffda;
        }
        .neon-theme .number-box:hover {
            background-color: #ff00ff;
            color: #000;
            box-shadow: 0 0 5px #ff00ff, 0 0 10px #ff00ff;
        }
        .neon-theme .number-box.selected {
            background-color: #00ffff;
            color: #000;
            box-shadow: 0 0 5px #00ffff, 0 0 10px #00ffff;
        }
        .neon-theme .number-box.assigned {
            background-color: #222233;
            color: #555566;
            text-decoration-color: #555566;
        }
        .neon-theme #add-button { background-color: #00aaff; }
        .neon-theme #add-button:hover { background-color: #0077cc; }
        .neon-theme #sorteo-button { background-color: #ff00ff; }
        .neon-theme #sorteo-button:hover { background-color: #cc00cc; }
        .neon-theme #clear-button { background-color: #e04040; }
        .neon-theme #clear-button:hover { background-color: #a02020; }
        .neon-theme .add-numbers-group button, .neon-theme .range-buttons button { background-color: #64ffda; color: #000; }
        .neon-theme .add-numbers-group button:hover, .neon-theme .range-buttons button:hover { background-color: #00e6b8; }
        .neon-theme #results-container, .neon-theme #history-container {
            background-color: #1a1a2a;
            border: 1px solid #64ffda;
            box-shadow: inset 0 0 5px #64ffda;
        }
        .neon-theme .person-entry, .neon-theme .history-entry {
            border-bottom: 1px solid #64ffda;
        }
        .neon-theme .person-name {
            color: #ff00ff;
        }
        .neon-theme .action-button {
            color: #64ffda;
        }
        .neon-theme .action-button:hover {
            color: #00ffff;
        }
        .neon-theme .edit-mode input[type="text"] {
            background-color: #333344;
            color: #64ffda;
            border-color: #64ffda;
        }
        .neon-theme .edit-mode .person-number-chip {
            background-color: #64ffda;
            color: #000;
        }
        .neon-theme .edit-mode .person-number-chip button {
            color: #ff00ff;
        }
        .neon-theme .edit-mode #add-number-btn { background-color: #00ffff; color: #000; }
        .neon-theme .edit-mode #add-number-btn:hover { background-color: #00cccc; }
        .neon-theme .edit-mode #update-name-btn { background-color: #ff00ff; color: #000; }
        .neon-theme .edit-mode #update-name-btn:hover { background-color: #cc00cc; }
        .neon-theme #ganador-container h2 {
            color: #ff00ff;
            text-shadow: 0 0 10px #ff00ff;
        }
        .neon-theme #ganador-nombre {
            color: #ff00ff;
            text-shadow: 0 0 10px #ff00ff;
        }
        .neon-theme #ganador-numero {
            color: #00ffff;
            text-shadow: 0 0 10px #00ffff;
        }
        .neon-theme #countdown-timer {
            color: #ff00ff;
            text-shadow: 0 0 10px #ff00ff;
        }
        
        /* --- ESTILOS TEMA PASTEL DREAMS --- */
        body.pastel-theme {
            background-color: #f7e1e6;
            color: #5e548e;
            font-family: 'Comic Sans MS', cursive, sans-serif;
        }
        .container.pastel-theme {
            background-color: #fff0f3;
            box-shadow: 0 4px 15px rgba(181, 126, 220, 0.4);
            border: 2px solid #b57edc;
        }
        .pastel-theme h1 {
            color: #ff66a4;
            text-shadow: 1px 1px 5px rgba(255, 102, 164, 0.5);
            font-family: 'Comic Sans MS', cursive, sans-serif;
        }
        .pastel-theme label {
            color: #9381ff;
        }
        .pastel-theme input[type="text"] {
            background-color: #fff8f8;
            color: #5e548e;
            border: 1px solid #b57edc;
            box-shadow: inset 0 0 5px rgba(181, 126, 220, 0.2);
        }
        .pastel-theme #numbers-container {
            background-color: #fef0f8;
            border: 1px solid #b57edc;
        }
        .pastel-theme .number-box {
            background-color: #f0e1ff;
            color: #5e548e;
            border: 1px solid #b57edc;
        }
        .pastel-theme .number-box:hover {
            background-color: #c7b3e6;
            color: #fff;
        }
        .pastel-theme .number-box.selected {
            background-color: #ff66a4;
            color: #fff;
            transform: scale(1.05);
            box-shadow: 0 0 5px #ff66a4;
        }
        .pastel-theme .number-box.assigned {
            background-color: #e0e0e0;
            color: #a0a0a0;
        }
        .pastel-theme button {
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .pastel-theme #add-button { background-color: #b57edc; }
        .pastel-theme #add-button:hover { background-color: #a06ac9; }
        .pastel-theme #sorteo-button { background-color: #4a91f2; }
        .pastel-theme #sorteo-button:hover { background-color: #3b7ad6; }
        .pastel-theme #clear-button { background-color: #ff8c42; }
        .pastel-theme #clear-button:hover { background-color: #e67d35; }
        .pastel-theme .add-numbers-group button, .pastel-theme .range-buttons button { background-color: #72b9e6; }
        .pastel-theme .add-numbers-group button:hover, .pastel-theme .range-buttons button:hover { background-color: #61a9d4; }
        .pastel-theme #results-container, .pastel-theme #history-container {
            background-color: #fff8f8;
            border: 1px solid #b57edc;
        }
        .pastel-theme .person-entry, .pastel-theme .history-entry {
            border-bottom: 1px solid #e0c8ee;
        }
        .pastel-theme .person-name {
            color: #4a91f2;
        }
        .pastel-theme .action-button {
            color: #9381ff;
        }
        .pastel-theme .action-button:hover {
            color: #ff66a4;
        }
        .pastel-theme .edit-mode input[type="text"] {
            background-color: #fff0f3;
            color: #5e548e;
            border-color: #b57edc;
        }
        .pastel-theme .edit-mode .person-number-chip {
            background-color: #e0c8ee;
            color: #5e548e;
        }
        .pastel-theme .edit-mode .person-number-chip button {
            color: #ff66a4;
        }
        .pastel-theme .edit-mode #add-number-btn { background-color: #b57edc; color: #fff; }
        .pastel-theme .edit-mode #add-number-btn:hover { background-color: #a06ac9; }
        .pastel-theme .edit-mode #update-name-btn { background-color: #ff66a4; color: #fff; }
        .pastel-theme .edit-mode #update-name-btn:hover { background-color: #e65c92; }
        .pastel-theme #ganador-container h2 {
            color: #ff66a4;
        }
        .pastel-theme #ganador-nombre {
            color: #b57edc;
        }
        .pastel-theme #ganador-numero {
            color: #4a91f2;
        }
        .pastel-theme #countdown-timer {
            color: #ff8c42;
        }
        .pastel-theme #theme-selector {
            background-color: #fff0f3;
            color: #5e548e;
            border-color: #b57edc;
        }
        #theme-toggle-group {
            margin-top: 0;
            justify-content: flex-end;
        }
        #theme-selector {
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ccc;
            background-color: #fff;
            color: #333;
        }
        .cosmic-theme #theme-selector {
            background-color: #220044;
            color: #a0d4ff;
            border-color: #4b0082;
        }
        .neon-theme #theme-selector {
            background-color: #333344;
            color: #64ffda;
            border-color: #64ffda;
        }
        .pastel-theme #theme-selector {
            background-color: #fff8f8;
            color: #5e548e;
            border-color: #b57edc;
        }
        .hide-on-edit-mode {
            display: none;
        }
        /* ESTILOS PARA LOS BOTONES DE GUARDAR/CARGAR */
        #save-data-button { background-color: #6c757d; }
        #save-data-button:hover { background-color: #5a6268; }
        #load-data-button { background-color: #17a2b8; }
        #load-data-button:hover { background-color: #138496; }
        .cosmic-theme #save-data-button { background-color: #663399; }
        .cosmic-theme #save-data-button:hover { background-color: #5a2c8a; }
        .cosmic-theme #load-data-button { background-color: #00aaff; }
        .cosmic-theme #load-data-button:hover { background-color: #0077cc; }
        .neon-theme #save-data-button { background-color: #ff00ff; color: #000; }
        .neon-theme #save-data-button:hover { background-color: #cc00cc; }
        .neon-theme #load-data-button { background-color: #00ffff; color: #000; }
        .neon-theme #load-data-button:hover { background-color: #00cccc; }
        .pastel-theme #save-data-button { background-color: #b57edc; }
        .pastel-theme #save-data-button:hover { background-color: #a06ac9; }
        .pastel-theme #load-data-button { background-color: #72b9e6; }
        .pastel-theme #load-data-button:hover { background-color: #61a9d4; }
        
        #save-code-container {
            margin-top: 15px;
            padding: 10px;
            background-color: #eee;
            border: 1px solid #ccc;
            border-radius: 4px;
            display: none;
            word-break: break-all;
            text-align: center;
        }
        #save-code-container h4 {
            margin: 0;
            font-size: 1em;
            color: #555;
        }
        #saved-code {
            font-size: 1.5em;
            font-weight: bold;
            color: #007BFF;
            font-family: 'Courier New', monospace;
        }
        
        .cosmic-theme #save-code-container {
            background-color: #220044;
            border-color: #4b0082;
        }
        .cosmic-theme #save-code-container h4 {
            color: #b3a0d3;
        }
        .cosmic-theme #saved-code {
            color: #a0d4ff;
        }
        
        .neon-theme #save-code-container {
            background-color: #1a1a2a;
            border-color: #64ffda;
        }
        .neon-theme #save-code-container h4 {
            color: #f0f0f0;
        }
        .neon-theme #saved-code {
            color: #ff00ff;
        }
        
        .pastel-theme #save-code-container {
            background-color: #fff8f8;
            border-color: #b57edc;
        }
        .pastel-theme #save-code-container h4 {
            color: #5e548e;
        }
        .pastel-theme #saved-code {
            color: #b57edc;
        }
        /* --- NUEVO ESTILO PARA EL BORDE DE RESALTE --- */
        .number-box.resaltado {
            border: 3px solid #ff5722; /* Color naranja, puedes cambiarlo */
            transform: scale(1.1);
        }
        /* Fin de los nuevos estilos */
        .footer {
            text-align: center;
            margin-top: 20px;
            font-size: 0.9em;
            color: #888;
        }

        /* -------------------------------------- */
        /* --- ESTILOS TEMA HACKER (ACTUALIZADO) --- */
        /* -------------------------------------- */
        body.hacker-theme {
            background-color: #000000;
            color: #00ff00; /* Texto principal verde neón */
            font-family: 'Consolas', 'Courier New', monospace;
            overflow: hidden; /* Para que el canvas de fondo no cause scroll */
            position: relative; /* Necesario para posicionar el canvas */
        }
        /* Estilos del canvas para el efecto Matrix */
        #matrixCanvas {
            position: fixed;
            top: 0;
            left: 0;
            z-index: -1;
            display: none; /* Se mostrará con JS solo para este tema */
        }
        /* El logo cambiará de color a verde neón */
        .hacker-theme .logo {
            filter: brightness(0) invert(1) sepia(1) saturate(10000%) hue-rotate(90deg);
        }
        .container.hacker-theme {
            background-color: rgba(10, 20, 10, 0.9); /* Fondo oscuro semitransparente */
            box-shadow: 0 0 15px 5px rgba(0, 255, 0, 0.6); /* Sombra verde neón */
            border: 1px solid #00ff00; /* Borde verde */
        }
        .hacker-theme h1 {
            color: #00ff00;
            text-shadow: 0 0 5px #00ff00, 0 0 15px #00ff00;
            font-family: 'Consolas', 'Courier New', monospace;
        }
        .hacker-theme label {
            color: #00ff00;
        }
        .hacker-theme input[type="text"] {
            background-color: #0a0a0a;
            color: #00ff00;
            border: 1px solid #00ff00;
            box-shadow: inset 0 0 5px rgba(0, 255, 0, 0.5);
        }
        .hacker-theme #numbers-container {
            background-color: #0a0a0a;
            border: 1px solid #00ff00;
            box-shadow: inset 0 0 5px rgba(0, 255, 0, 0.5);
        }
        .hacker-theme .number-box {
            background-color: #003300; /* Verde oscuro */
            color: #00ff00;
            border: 1px solid #00ff00;
        }
        .hacker-theme .number-box:hover {
            background-color: #007700; /* Verde más claro al pasar el ratón */
            box-shadow: 0 0 8px #00ff00;
            color: #fff; /* Blanco brillante */
        }
        .hacker-theme .number-box.selected {
            background-color: #00ff00;
            color: #000000; /* Texto negro en verde */
            box-shadow: 0 0 10px #00ff00, 0 0 20px #00ff00;
        }
        .hacker-theme .number-box.assigned {
            background-color: #111111;
            color: #006600;
            text-decoration-color: #006600;
        }
        .hacker-theme button {
            font-family: 'Consolas', 'Courier New', monospace;
        }
        .hacker-theme #add-button { background-color: #00aa00; }
        .hacker-theme #add-button:hover { background-color: #007700; }
        .hacker-theme #clear-button { background-color: #aa0000; }
        .hacker-theme #clear-button:hover { background-color: #770000; }
        .hacker-theme #sorteo-button { background-color: #00ff00; color: #000; }
        .hacker-theme #sorteo-button:hover { background-color: #00cc00; }
        .hacker-theme .add-numbers-group button, .hacker-theme .range-buttons button { background-color: #009900; }
        .hacker-theme .add-numbers-group button:hover, .hacker-theme .range-buttons button:hover { background-color: #006600; }

        .hacker-theme #results-container, .hacker-theme #history-container {
            background-color: #0a0a0a;
            border: 1px solid #00ff00;
            box-shadow: inset 0 0 5px rgba(0, 255, 0, 0.5);
        }
        .hacker-theme .person-entry, .hacker-theme .history-entry {
            border-bottom: 1px dotted #006600; /* Borde punteado */
        }
        .hacker-theme .person-name {
            color: #00ff00;
        }
        .hacker-theme .action-button {
            color: #00ff00;
        }
        .hacker-theme .action-button:hover {
            color: #ffffff;
        }
        .hacker-theme .edit-mode input[type="text"] {
            background-color: #0a0a0a;
            color: #00ff00;
            border-color: #00ff00;
        }
        .hacker-theme .edit-mode .person-number-chip {
            background-color: #006600;
            color: #00ff00;
        }
        .hacker-theme .edit-mode .person-number-chip button {
            color: #ff0000; /* Botón de eliminar en rojo */
        }
        .hacker-theme .edit-mode #add-number-btn { background-color: #009900; color: #fff; }
        .hacker-theme .edit-mode #add-number-btn:hover { background-color: #006600; }
        .hacker-theme .edit-mode #update-name-btn { background-color: #00aa00; color: #fff; }
        .hacker-theme .edit-mode #update-name-btn:hover { background-color: #007700; }

        .hacker-theme #ganador-container h2 {
            color: #00ff00;
            text-shadow: 0 0 10px #00ff00;
        }
        .hacker-theme #ganador-nombre, .hacker-theme #ganador-numero {
            color: #00ff00;
            text-shadow: 0 0 10px #00ff00;
        }
        .hacker-theme #ganador-numero {
            color: #00cc00; /* Un verde ligeramente diferente para el número */
        }
        .hacker-theme #countdown-timer {
            color: #ff0000; /* Contador en rojo para contraste */
            text-shadow: 0 0 10px #ff0000;
        }
        .hacker-theme #theme-selector {
            background-color: #0a0a0a;
            color: #00ff00;
            border-color: #00ff00;
        }
        .hacker-theme #save-data-button { background-color: #004400; }
        .hacker-theme #save-data-button:hover { background-color: #003300; }
        .hacker-theme #load-data-button { background-color: #007700; }
        .hacker-theme #load-data-button:hover { background-color: #005500; }

        #save-code-container {
            margin-top: 15px;
            padding: 10px;
            background-color: #eee;
            border: 1px solid #ccc;
            border-radius: 4px;
            display: none;
            word-break: break-all;
            text-align: center;
        }
        #save-code-container h4 {
            margin: 0;
            font-size: 1em;
            color: #555;
        }
        #saved-code {
            font-size: 1.5em;
            font-weight: bold;
            color: #007BFF;
            font-family: 'Courier New', monospace;
        }
        
        .cosmic-theme #save-code-container {
            background-color: #220044;
            border-color: #4b0082;
        }
        .cosmic-theme #save-code-container h4 {
            color: #b3a0d3;
        }
        .cosmic-theme #saved-code {
            color: #a0d4ff;
        }
        
        .neon-theme #save-code-container {
            background-color: #1a1a2a;
            border-color: #64ffda;
        }
        .neon-theme #save-code-container h4 {
            color: #f0f0f0;
        }
        .neon-theme #saved-code {
            color: #ff00ff;
        }
        
        .pastel-theme #save-code-container {
            background-color: #fff8f8;
            border-color: #b57edc;
        }
        .pastel-theme #save-code-container h4 {
            color: #5e548e;
        }
        .pastel-theme #saved-code {
            color: #b57edc;
        }
        .number-box.resaltado {
            border: 3px solid #ff5722;
            transform: scale(1.1);
        }
        .hacker-theme .number-box.resaltado {
            border: 3px solid #ffff00;
            box-shadow: 0 0 10px #ffff00, 0 0 20px #ffff00;
        }
        .footer {
            text-align: center;
            margin-top: 20px;
            font-size: 0.9em;
            color: #888;
        }
    </style>
</head>
<body>
    <canvas id="matrixCanvas"></canvas>
    <div class="container">
        <div id="theme-toggle-group">
            <select id="theme-selector">
                <option value="default">Clásico</option>
                <option value="cosmic">Cósmico</option>
                <option value="neon">Neon Party</option>
                <option value="pastel">Pastel Dreams</option>
                <option value="hacker">Hacker</option>
            </select>
        </div>
        <div class="logo-container">
            <img src="https://i.ibb.co/6P6X2yH/logo-redpilar.png" alt="Logo de Red Pilar" class="logo">
        </div>
        <h1 id="main-title">Sorteo Red Pilar</h1>
        <div id="form-container">
            <div class="form-group">
                <label for="person-name">Nombre del Participante:</label>
                <input type="text" id="person-name" placeholder="Escribe el nombre aquí">
            </div>
            <div class="form-group">
                <label>Selecciona los números:</label>
                <div id="numbers-container"></div>
            </div>
            <div class="add-numbers-group">
                <button id="add-10-button">+10</button>
                <button id="add-25-button">+25</button>
                <button id="add-50-button">+50</button>
            </div>
            <div class="button-group">
                <button id="add-button">Añadir Participante</button>
                <button id="clear-button">Limpiar Selección</button>
            </div>
        </div>
        
        <div id="results-container">
            <h2>Participantes</h2>
            <div id="participants-list"></div>
        </div>
        
        <div class="button-group hide-on-edit-mode">
            <button id="sorteo-button">Realizar Sorteo</button>
            <button id="save-data-button">Guardar Datos</button>
            <button id="load-data-button">Cargar Datos</button>
        </div>

        <div id="save-code-container">
            <h4>Código de guardado:</h4>
            <span id="saved-code"></span>
        </div>
        
        <div id="ganador-container">
            <h2>🎉 Ganador del Sorteo 🎉</h2>
            <div id="ganador-numero"></div>
            <div id="ganador-nombre"></div>
            <div id="countdown-timer"></div>
        </div>
        
        <div id="history-container">
            <h2>Historial de Sorteos</h2>
            <div id="history-list"></div>
        </div>

        <p class="footer">
            <a href="https://www.redpilar.com.ar" target="_blank">RedPilar.com.ar</a> - Sorteo Digital
        </p>

    </div>

    <script>
        const personNameInput = document.getElementById('person-name');
        const numbersContainer = document.getElementById('numbers-container');
        const addButton = document.getElementById('add-button');
        const clearButton = document.getElementById('clear-button');
        const sorteoButton = document.getElementById('sorteo-button');
        const participantsList = document.getElementById('participants-list');
        const ganadorNombre = document.getElementById('ganador-nombre');
        const ganadorNumero = document.getElementById('ganador-numero');
        const countdownTimer = document.getElementById('countdown-timer');
        const historyList = document.getElementById('history-list');
        const add10Button = document.getElementById('add-10-button');
        const add25Button = document.getElementById('add-25-button');
        const add50Button = document.getElementById('add-50-button');
        const saveDataButton = document.getElementById('save-data-button');
        const loadDataButton = document.getElementById('load-data-button');
        const saveCodeContainer = document.getElementById('save-code-container');
        const savedCodeSpan = document.getElementById('saved-code');
        const themeSelector = document.getElementById('theme-selector');
        
        let allNumbers = [];
        let assignedNumbers = new Set();
        let selectedNumbers = new Set();
        let participants = [];
        let history = [];
        
        let isEditing = false;
        let editingIndex = -1;

        // --- Lógica del Sorteo ---
        function generateNumbers(count = 100) {
            allNumbers = Array.from({ length: count }, (_, i) => i + 1);
            renderNumbers();
        }

        function renderNumbers() {
            numbersContainer.innerHTML = '';
            allNumbers.forEach(num => {
                const numberBox = document.createElement('div');
                numberBox.classList.add('number-box');
                numberBox.textContent = num;
                numberBox.dataset.number = num;

                if (assignedNumbers.has(num)) {
                    numberBox.classList.add('assigned');
                }
                if (selectedNumbers.has(num)) {
                    numberBox.classList.add('selected');
                }

                numberBox.addEventListener('click', () => {
                    if (!assignedNumbers.has(num)) {
                        if (selectedNumbers.has(num)) {
                            selectedNumbers.delete(num);
                            numberBox.classList.remove('selected');
                        } else {
                            selectedNumbers.add(num);
                            numberBox.classList.add('selected');
                        }
                    }
                });
                numbersContainer.appendChild(numberBox);
            });
        }

        function addParticipant() {
            const name = personNameInput.value.trim();
            if (name === '') {
                alert('Por favor, introduce un nombre.');
                return;
            }
            if (selectedNumbers.size === 0) {
                alert('Por favor, selecciona al menos un número.');
                return;
            }

            const newParticipant = {
                name: name,
                numbers: Array.from(selectedNumbers).sort((a, b) => a - b)
            };

            if (isEditing) {
                const oldNumbers = participants[editingIndex].numbers;
                oldNumbers.forEach(num => assignedNumbers.delete(num));
                participants[editingIndex] = newParticipant;
                isEditing = false;
                editingIndex = -1;
                document.body.classList.remove('edit-mode');
                addButton.textContent = 'Añadir Participante';
            } else {
                participants.push(newParticipant);
            }

            selectedNumbers.forEach(num => assignedNumbers.add(num));
            
            personNameInput.value = '';
            selectedNumbers.clear();
            
            renderNumbers();
            renderParticipants();
            saveToLocalStorage();
        }

        function renderParticipants() {
            participantsList.innerHTML = '';
            participants.forEach((person, index) => {
                const personEntry = document.createElement('div');
                personEntry.classList.add('person-entry');

                const personInfo = document.createElement('div');
                personInfo.classList.add('person-info');
                personInfo.innerHTML = `
                    <div class="person-name">${person.name}</div>
                    <div class="person-numbers">Números: ${person.numbers.join(', ')}</div>
                `;
                personEntry.appendChild(personInfo);

                const personActions = document.createElement('div');
                personActions.classList.add('person-actions');
                
                const editButton = document.createElement('button');
                editButton.innerHTML = '✏️';
                editButton.classList.add('action-button');
                editButton.title = 'Editar';
                editButton.addEventListener('click', () => editParticipant(index));
                personActions.appendChild(editButton);

                const deleteButton = document.createElement('button');
                deleteButton.innerHTML = '🗑️';
                deleteButton.classList.add('action-button');
                deleteButton.title = 'Eliminar';
                deleteButton.addEventListener('click', () => deleteParticipant(index));
                personActions.appendChild(deleteButton);

                personEntry.appendChild(personActions);
                participantsList.appendChild(personEntry);
            });
        }

        function editParticipant(index) {
            const personToEdit = participants[index];
            personNameInput.value = personToEdit.name;
            selectedNumbers.clear();
            personToEdit.numbers.forEach(num => selectedNumbers.add(num));
            renderNumbers();
            
            isEditing = true;
            editingIndex = index;
            addButton.textContent = 'Actualizar Participante';
            document.body.classList.add('edit-mode');
        }

        function deleteParticipant(index) {
            if (confirm('¿Estás seguro de que quieres eliminar a este participante?')) {
                const personToDelete = participants[index];
                personToDelete.numbers.forEach(num => assignedNumbers.delete(num));
                participants.splice(index, 1);
                
                renderNumbers();
                renderParticipants();
                saveToLocalStorage();
            }
        }

        function clearSelection() {
            selectedNumbers.clear();
            renderNumbers();
        }

        function selectRange(count) {
            selectedNumbers.clear();
            const unassignedNumbers = allNumbers.filter(num => !assignedNumbers.has(num));
            for (let i = 0; i < Math.min(count, unassignedNumbers.length); i++) {
                selectedNumbers.add(unassignedNumbers[i]);
            }
            renderNumbers();
        }

        async function realizarSorteo() {
            if (participants.length === 0) {
                alert('No hay participantes para el sorteo.');
                return;
            }
            if (history.length > 0 && confirm('¿Deseas realizar otro sorteo? El historial será conservado.')) {
                // Si el usuario confirma, no hacemos nada más que continuar con el sorteo.
            } else if (history.length > 0) {
                return; // Si el usuario cancela, no hacemos nada.
            }
            
            const allAssignedNumbers = Array.from(assignedNumbers);
            if (allAssignedNumbers.length === 0) {
                alert('No hay números asignados para sortear.');
                return;
            }

            sorteoButton.disabled = true;
            clearButton.disabled = true;

            ganadorNombre.textContent = '';
            ganadorNumero.textContent = '';
            countdownTimer.style.display = 'block';

            let countdown = 3;
            const countdownInterval = setInterval(() => {
                countdownTimer.textContent = countdown;
                if (countdown === 0) {
                    clearInterval(countdownInterval);
                    countdownTimer.style.display = 'none';
                    rollRandomNumber(allAssignedNumbers);
                }
                countdown--;
            }, 1000);
        }

        function rollRandomNumber(numbersPool) {
            let rollCount = 0;
            const maxRolls = 100;
            const rollInterval = 50;

            const finalWinnerNumber = numbersPool[Math.floor(Math.random() * numbersPool.length)];

            const rollingInterval = setInterval(() => {
                const tempNumber = numbersPool[Math.floor(Math.random() * numbersPool.length)];
                ganadorNumero.textContent = tempNumber;

                // Animar el número mientras se "sortea"
                ganadorNumero.classList.add('sorteo-running');

                rollCount++;
                if (rollCount >= maxRolls) {
                    clearInterval(rollingInterval);
                    ganadorNumero.classList.remove('sorteo-running');
                    showWinner(finalWinnerNumber);
                }
            }, rollInterval);
        }

        function showWinner(winnerNumber) {
            const winner = participants.find(p => p.numbers.includes(winnerNumber));
            const winningPersonName = winner ? winner.name : 'Desconocido';

            ganadorNombre.textContent = winningPersonName;
            ganadorNumero.textContent = winnerNumber;
            
            ganadorNombre.classList.add('ganador-zoom');
            ganadorNumero.classList.add('ganador-zoom');

            setTimeout(() => {
                ganadorNombre.classList.remove('ganador-zoom');
                ganadorNumero.classList.remove('ganador-zoom');
            }, 1000);

            // Resaltar el número ganador
            const winningNumberBox = document.querySelector(`.number-box[data-number="${winnerNumber}"]`);
            if (winningNumberBox) {
                winningNumberBox.classList.add('resaltado');
            }

            // Registrar en el historial
            history.push({
                winnerName: winningPersonName,
                winnerNumber: winnerNumber,
                timestamp: new Date().toLocaleString()
            });

            renderHistory();
            createConfetti();

            sorteoButton.disabled = false;
            clearButton.disabled = false;
            saveToLocalStorage();
        }

        function renderHistory() {
            historyList.innerHTML = '';
            history.forEach(entry => {
                const historyEntry = document.createElement('div');
                historyEntry.classList.add('history-entry');
                historyEntry.innerHTML = `
                    <div class="person-info">
                        <div class="person-name">Ganador: ${entry.winnerName}</div>
                        <div class="person-numbers">Número: ${entry.winnerNumber} (${entry.timestamp})</div>
                    </div>
                `;
                historyList.appendChild(historyEntry);
            });
        }

        function createConfetti() {
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.classList.add('confetti');
                confetti.style.left = `${Math.random() * 100}%`;
                confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
                confetti.style.animationDelay = `${Math.random() * 0.5}s`;
                confetti.style.animationDuration = `${Math.random() * 3 + 2}s`;
                document.body.appendChild(confetti);

                confetti.addEventListener('animationend', () => {
                    confetti.remove();
                });
            }
        }

        // --- Funcionalidad de Guardado y Carga ---
        function saveToLocalStorage() {
            const data = {
                participants: participants,
                assignedNumbers: Array.from(assignedNumbers),
                history: history,
                theme: themeSelector.value
            };
            const compressedData = btoa(JSON.stringify(data));
            localStorage.setItem('raffleData', compressedData);
        }

        function loadFromLocalStorage() {
            const compressedData = localStorage.getItem('raffleData');
            if (compressedData) {
                const decompressedData = JSON.parse(atob(compressedData));
                participants = decompressedData.participants;
                assignedNumbers = new Set(decompressedData.assignedNumbers);
                history = decompressedData.history;
                
                renderNumbers();
                renderParticipants();
                renderHistory();
            }
        }

        function generateSaveCode() {
            const data = {
                participants: participants,
                assignedNumbers: Array.from(assignedNumbers),
                history: history,
                theme: themeSelector.value
            };
            const compressedData = btoa(JSON.stringify(data));
            savedCodeSpan.textContent = compressedData;
            saveCodeContainer.style.display = 'block';
        }

        function loadFromCode() {
            const code = prompt('Introduce el código de guardado:');
            if (code) {
                try {
                    const decompressedData = JSON.parse(atob(code));
                    participants = decompressedData.participants;
                    assignedNumbers = new Set(decompressedData.assignedNumbers);
                    history = decompressedData.history;
                    
                    renderNumbers();
                    renderParticipants();
                    renderHistory();
                    
                    if (decompressedData.theme) {
                        themeSelector.value = decompressedData.theme;
                        applyTheme(decompressedData.theme);
                    }
                } catch (e) {
                    alert('Código inválido.');
                }
            }
        }

        // --- Manejo de Temas ---
        function applyTheme(theme) {
            document.body.className = '';
            document.body.classList.add(`${theme}-theme`);
            localStorage.setItem('selectedTheme', theme);

            if (theme === 'hacker') {
                initMatrixEffect();
            } else {
                const canvas = document.getElementById('matrixCanvas');
                if (canvas) {
                    canvas.style.display = 'none';
                    // Para detener el efecto de Matrix si ya estaba corriendo
                    // No hay una forma limpia de detener requestAnimationFrame, pero
                    // la lógica del bucle lo detendrá cuando se cambie el tema.
                }
            }
        }

        themeSelector.addEventListener('change', (event) => {
            applyTheme(event.target.value);
        });

        document.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('selectedTheme') || 'default';
            themeSelector.value = savedTheme;
            applyTheme(savedTheme);
            loadFromLocalStorage();
            generateNumbers(100);
        });

        // --- Script para el efecto Matrix de fondo (Tema Hacker) ---
        function initMatrixEffect() {
            const canvas = document.getElementById('matrixCanvas');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            canvas.style.display = 'block';

            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            const alphabet = 'アァカサタナハマヤラワガザダバパイィキシチニヒミリヰギジヂビピウゥクスツヌフムユルグズヅブプエェケセテネヘメレヱゲゼデベペオォコソトノホモヨロヲゴゾドボポヴッンABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';

            const fontSize = 16;
            let columns = Math.floor(canvas.width / fontSize);

            const drops = [];
            for (let i = 0; i < columns; i++) {
                drops[i] = 1;
            }

            let lastTime = 0;
            const fps = 30;
            const interval = 1000 / fps;

            function drawMatrix(currentTime) {
                if (!document.body.classList.contains('hacker-theme')) {
                    cancelAnimationFrame(drawMatrix);
                    return;
                }
                
                if (currentTime - lastTime > interval) {
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);

                    ctx.fillStyle = '#00ff00';
                    ctx.font = fontSize + 'px monospace';

                    for (let i = 0; i < drops.length; i++) {
                        const text = alphabet.charAt(Math.floor(Math.random() * alphabet.length));
                        ctx.fillText(text, i * fontSize, drops[i] * fontSize);

                        if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
                            drops[i] = 0;
                        }
                        drops[i]++;
                    }
                    lastTime = currentTime;
                }
                requestAnimationFrame(drawMatrix);
            }

            requestAnimationFrame(drawMatrix);

            window.addEventListener('resize', () => {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                columns = Math.floor(canvas.width / fontSize);
                if (drops.length !== columns) {
                    const oldDrops = drops.slice();
                    drops.length = columns;
                    for(let i = 0; i < columns; i++) {
                        if (drops[i] === undefined) {
                            drops[i] = (oldDrops[i] !== undefined) ? oldDrops[i] : 1;
                        }
                    }
                }
            });
        }

        // --- Event Listeners ---
        addButton.addEventListener('click', addParticipant);
        clearButton.addEventListener('click', clearSelection);
        sorteoButton.addEventListener('click', realizarSorteo);
        add10Button.addEventListener('click', () => selectRange(10));
        add25Button.addEventListener('click', () => selectRange(25));
        add50Button.addEventListener('click', () => selectRange(50));
        saveDataButton.addEventListener('click', generateSaveCode);
        loadDataButton.addEventListener('click', loadFromCode);
    </script>
</body>
</html>
