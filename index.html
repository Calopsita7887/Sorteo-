<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sorteo Red Pilar</title>
    <style>
        /* --- ESTILOS GENERALES (TEMA PREDETERMINADO) --- */
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f2f5;
            color: #333;
            margin: 0;
            padding: 20px;
            transition: background-color 0.5s ease, color 0.5s ease;
        }
        .container {
            max-width: 600px;
            margin: auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
            transition: background-color 0.5s ease, box-shadow 0.5s ease, border 0.5s ease;
        }
        .logo-container {
            text-align: center;
            margin-bottom: 20px;
        }
        .logo {
            width: 100px;
            height: auto;
        }
        h1 {
            color: #4CAF50;
            text-align: center;
            transition: color 0.5s ease;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            transition: color 0.5s ease;
        }
        input[type="text"] {
            width: calc(100% - 22px);
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
            transition: border-color 0.5s ease, background-color 0.5s ease, color 0.5s ease;
        }
        #numbers-container {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 5px;
            margin-top: 10px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            max-height: 250px;
            overflow-y: auto;
            transition: border-color 0.5s ease, background-color 0.5s ease;
        }
        .number-box {
            background-color: #e9e9e9;
            text-align: center;
            padding: 8px 0;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s, color 0.2s, border 0.2s ease;
            font-size: 14px;
            font-weight: bold;
        }
        .number-box:hover {
            background-color: #ddd;
        }
        .number-box.selected {
            background-color: #4CAF50;
            color: #fff;
            transform: scale(1.05);
        }
        .number-box.assigned {
            background-color: #ccc;
            text-decoration: line-through;
            color: #777;
            cursor: not-allowed;
        }
        .button-group, .add-numbers-group, #theme-toggle-group, .range-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        .add-numbers-group, .range-buttons {
            margin-top: 10px;
        }
        .range-buttons button {
            flex-grow: 1;
            margin-right: 5px;
        }
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            color: #fff;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.2s;
            flex-grow: 1;
            margin: 0 5px;
        }
        button:first-child { margin-left: 0; }
        button:last-child { margin-right: 0; }
        #add-button { background-color: #4CAF50; }
        #add-button:hover { background-color: #45a049; }
        #clear-button { background-color: #f44336; }
        #clear-button:hover { background-color: #da190b; }
        #sorteo-button { background-color: #007BFF; }
        #sorteo-button:hover { background-color: #0056b3; }
        .add-numbers-group button, .range-buttons button { background-color: #17a2b8; }
        .add-numbers-group button:hover, .range-buttons button:hover { background-color: #138496; }
        #results-container, #history-container {
            margin-top: 30px;
            padding: 15px;
            background-color: #fff;
            border-radius: 8px;
            border: 1px solid #eee;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
            transition: background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease;
        }
        .person-entry, .history-entry {
            border-bottom: 1px solid #eee;
            padding: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: border-color 0.5s ease;
        }
        .person-entry:last-child, .history-entry:last-child {
            border-bottom: none;
        }
        .person-info {
            flex-grow: 1;
        }
        .person-name {
            font-weight: bold;
            color: #007BFF;
            margin-bottom: 5px;
            transition: color 0.5s ease;
        }
        .person-numbers {
            font-size: 14px;
        }
        .person-actions {
            margin-left: 10px;
        }
        .action-button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2em;
            margin-left: 5px;
            color: #777;
            transition: color 0.2s;
        }
        .action-button:hover {
            color: #000;
        }
        .edit-mode .person-info, .edit-mode .person-actions {
            flex-direction: column;
            align-items: flex-start;
        }
        .edit-mode .person-info {
            width: 100%;
        }
        .edit-mode .person-name {
            margin-bottom: 10px;
        }
        .edit-mode .person-actions {
            margin-top: 10px;
            display: flex;
            justify-content: flex-end;
            width: 100%;
        }
        .edit-mode .person-actions button {
            margin-left: 10px;
        }
        .edit-mode .person-numbers-list {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 5px;
        }
        .edit-mode .person-number-chip {
            background-color: #e9e9e9;
            padding: 5px 8px;
            border-radius: 12px;
            display: flex;
            align-items: center;
        }
        .edit-mode .person-number-chip button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1em;
            color: #f44336;
            margin-left: 5px;
            padding: 0;
        }
        .edit-mode .person-number-chip button:hover {
            color: #da190b;
        }
        /* ESTILOS DEL BOTÓN ACTUALIZADO EN MODO EDICIÓN */
        .edit-mode #add-number-btn { background-color: #007BFF; }
        .edit-mode #add-number-btn:hover { background-color: #0056b3; }
        .edit-mode #update-name-btn { background-color: #4CAF50; color: #fff; }
        .edit-mode #update-name-btn:hover { background-color: #45a049; }
        #ganador-container {
            margin-top: 20px;
            text-align: center;
            position: relative;
        }
        #ganador-container h2 {
            color: #ffc107;
            transition: color 0.5s ease;
        }
        #ganador-nombre, #ganador-numero {
            font-size: 2em;
            font-weight: bold;
            color: #007BFF;
            transition: transform 0.5s ease-in-out, color 0.5s ease;
            min-height: 1.5em;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #ganador-numero {
            color: #4CAF50;
            margin-bottom: 10px;
            transition: color 0.5s ease;
        }
        .sorteo-running {
            animation: spin 0.025s linear infinite;
        }
        .ganador-zoom {
            animation: winnerZoom 1s ease-in-out;
        }
        @keyframes winnerZoom {
            0% { transform: scale(0.5); opacity: 0; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); }
        }
        #countdown-timer {
            font-size: 3em;
            font-weight: bold;
            color: #f44336;
            margin-top: 20px;
            transition: color 0.5s ease;
        }
        .confetti {
            width: 10px;
            height: 10px;
            background-color: #f06;
            position: absolute;
            top: -10px;
            border-radius: 50%;
            z-index: 1;
        }
        @keyframes fall {
            to {
                top: 105%;
                transform: translate(-50%, 0) rotateZ(360deg);
                opacity: 0;
            }
        }
        
        /* --- ESTILOS TEMA COSMIC --- */
        body.cosmic-theme {
            background: #00001a;
            color: #e0e0ff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .container.cosmic-theme {
            background-color: #1a0033;
            box-shadow: 0 0 20px rgba(70, 0, 100, 0.8), inset 0 0 10px rgba(100, 0, 150, 0.5);
            border: 2px solid #5d00a0;
        }
        .cosmic-theme h1 {
            color: #d495ff;
            text-shadow: 0 0 5px #ff00ff, 0 0 10px #ff00ff;
        }
        .cosmic-theme label {
            color: #b3a0d3;
        }
        .cosmic-theme input[type="text"] {
            background-color: #220044;
            color: #a0d4ff;
            border-color: #4b0082;
            box-shadow: inset 0 0 5px rgba(160, 212, 255, 0.5);
        }
        .cosmic-theme #numbers-container {
            background-color: #220044;
            border-color: #4b0082;
            box-shadow: inset 0 0 10px rgba(160, 212, 255, 0.3);
        }
        .cosmic-theme .number-box {
            background-color: #330066;
            color: #e0e0ff;
            border: 1px solid #5d00a0;
        }
        .cosmic-theme .number-box:hover {
            background-color: #5d00a0;
            color: #fff;
            box-shadow: 0 0 5px #d495ff;
        }
        .cosmic-theme .number-box.selected {
            background-color: #8a2be2;
            color: #fff;
            box-shadow: 0 0 10px #ff00ff;
        }
        .cosmic-theme .number-box.assigned {
            background-color: #330044;
            color: #663399;
            text-decoration-color: #9966cc;
        }
        .cosmic-theme #add-button { background-color: #483d8b; }
        .cosmic-theme #add-button:hover { background-color: #6a5acd; }
        .cosmic-theme #sorteo-button { background-color: #d495ff; color: #000; }
        .cosmic-theme #sorteo-button:hover { background-color: #b56eff; }
        .cosmic-theme #clear-button { background-color: #e30022; }
        .cosmic-theme #clear-button:hover { background-color: #a30019; }
        .cosmic-theme .add-numbers-group button, .cosmic-theme .range-buttons button { background-color: #00aaff; }
        .cosmic-theme .add-numbers-group button:hover, .cosmic-theme .range-buttons button:hover { background-color: #0077cc; }
        .cosmic-theme #results-container, .cosmic-theme #history-container {
            background-color: #220044;
            border-color: #4b0082;
            box-shadow: inset 0 0 10px rgba(160, 212, 255, 0.3);
        }
        .cosmic-theme .person-entry, .cosmic-theme .history-entry {
            border-bottom: 1px solid #5d00a0;
        }
        .cosmic-theme .person-name {
            color: #a0d4ff;
        }
        .cosmic-theme .action-button {
            color: #b3a0d3;
        }
        .cosmic-theme .action-button:hover {
            color: #fff;
        }
        .cosmic-theme .edit-mode input[type="text"] {
            background-color: #330066;
            color: #a0d4ff;
            border-color: #5d00a0;
        }
        .cosmic-theme .edit-mode .person-number-chip {
            background-color: #5d00a0;
            color: #e0e0ff;
        }
        .cosmic-theme .edit-mode .person-number-chip button {
            color: #d495ff;
        }
        .cosmic-theme .edit-mode #add-number-btn { background-color: #00aaff; color: #fff; }
        .cosmic-theme .edit-mode #add-number-btn:hover { background-color: #0077cc; }
        .cosmic-theme .edit-mode #update-name-btn { background-color: #483d8b; color: #fff; }
        .cosmic-theme .edit-mode #update-name-btn:hover { background-color: #6a5acd; }
        .cosmic-theme #ganador-container h2 {
            color: #d495ff;
            text-shadow: 0 0 10px #ff00ff;
        }
        .cosmic-theme #ganador-nombre {
            color: #a0d4ff;
            text-shadow: 0 0 10px #a0d4ff;
        }
        .cosmic-theme #ganador-numero {
            color: #ff00ff;
            text-shadow: 0 0 10px #ff00ff;
        }
        .cosmic-theme #countdown-timer {
            color: #ff00ff;
            text-shadow: 0 0 10px #ff00ff;
        }
        /* --- ESTILOS TEMA NEON PARTY --- */
        body.neon-theme {
            background-color: #0a0a1a;
            color: #f0f0f0;
            font-family: 'Consolas', 'Courier New', monospace;
        }
        .container.neon-theme {
            background-color: #1a1a2a;
            box-shadow: 0 0 20px 5px rgba(100, 255, 255, 0.4);
            border: 1px solid #64ffda;
        }
        .neon-theme h1 {
            color: #ff00ff;
            text-shadow: 0 0 10px #ff00ff, 0 0 20px #ff00ff;
            font-family: 'Consolas', 'Courier New', monospace;
        }
        .neon-theme label {
            color: #f0f0f0;
        }
        .neon-theme input[type="text"] {
            background-color: #333344;
            color: #64ffda;
            border: 1px solid #64ffda;
            box-shadow: 0 0 5px #64ffda;
        }
        .neon-theme #numbers-container {
            background-color: #1a1a2a;
            border: 1px solid #64ffda;
            box-shadow: inset 0 0 5px #64ffda;
        }
        .neon-theme .number-box {
            background-color: #333344;
            color: #64ffda;
            border: 1px solid #64ffda;
        }
        .neon-theme .number-box:hover {
            background-color: #ff00ff;
            color: #000;
            box-shadow: 0 0 5px #ff00ff, 0 0 10px #ff00ff;
        }
        .neon-theme .number-box.selected {
            background-color: #00ffff;
            color: #000;
            box-shadow: 0 0 5px #00ffff, 0 0 10px #00ffff;
        }
        .neon-theme .number-box.assigned {
            background-color: #222233;
            color: #555566;
            text-decoration-color: #555566;
        }
        .neon-theme #add-button { background-color: #00aaff; }
        .neon-theme #add-button:hover { background-color: #0077cc; }
        .neon-theme #sorteo-button { background-color: #ff00ff; }
        .neon-theme #sorteo-button:hover { background-color: #cc00cc; }
        .neon-theme #clear-button { background-color: #e04040; }
        .neon-theme #clear-button:hover { background-color: #a02020; }
        .neon-theme .add-numbers-group button, .neon-theme .range-buttons button { background-color: #64ffda; color: #000; }
        .neon-theme .add-numbers-group button:hover, .neon-theme .range-buttons button:hover { background-color: #00e6b8; }
        .neon-theme #results-container, .neon-theme #history-container {
            background-color: #1a1a2a;
            border: 1px solid #64ffda;
            box-shadow: inset 0 0 5px #64ffda;
        }
        .neon-theme .person-entry, .neon-theme .history-entry {
            border-bottom: 1px solid #64ffda;
        }
        .neon-theme .person-name {
            color: #ff00ff;
        }
        .neon-theme .action-button {
            color: #64ffda;
        }
        .neon-theme .action-button:hover {
            color: #00ffff;
        }
        .neon-theme .edit-mode input[type="text"] {
            background-color: #333344;
            color: #64ffda;
            border-color: #64ffda;
        }
        .neon-theme .edit-mode .person-number-chip {
            background-color: #64ffda;
            color: #000;
        }
        .neon-theme .edit-mode .person-number-chip button {
            color: #ff00ff;
        }
        .neon-theme .edit-mode #add-number-btn { background-color: #00ffff; color: #000; }
        .neon-theme .edit-mode #add-number-btn:hover { background-color: #00cccc; }
        .neon-theme .edit-mode #update-name-btn { background-color: #ff00ff; color: #000; }
        .neon-theme .edit-mode #update-name-btn:hover { background-color: #cc00cc; }
        .neon-theme #ganador-container h2 {
            color: #ff00ff;
            text-shadow: 0 0 10px #ff00ff;
        }
        .neon-theme #ganador-nombre {
            color: #ff00ff;
            text-shadow: 0 0 10px #ff00ff;
        }
        .neon-theme #ganador-numero {
            color: #00ffff;
            text-shadow: 0 0 10px #00ffff;
        }
        .neon-theme #countdown-timer {
            color: #ff00ff;
            text-shadow: 0 0 10px #ff00ff;
        }
        
        /* --- ESTILOS TEMA PASTEL DREAMS --- */
        body.pastel-theme {
            background-color: #f7e1e6;
            color: #5e548e;
            font-family: 'Comic Sans MS', cursive, sans-serif;
        }
        .container.pastel-theme {
            background-color: #fff0f3;
            box-shadow: 0 4px 15px rgba(181, 126, 220, 0.4);
            border: 2px solid #b57edc;
        }
        .pastel-theme h1 {
            color: #ff66a4;
            text-shadow: 1px 1px 5px rgba(255, 102, 164, 0.5);
            font-family: 'Comic Sans MS', cursive, sans-serif;
        }
        .pastel-theme label {
            color: #9381ff;
        }
        .pastel-theme input[type="text"] {
            background-color: #fff8f8;
            color: #5e548e;
            border: 1px solid #b57edc;
            box-shadow: inset 0 0 5px rgba(181, 126, 220, 0.2);
        }
        .pastel-theme #numbers-container {
            background-color: #fef0f8;
            border: 1px solid #b57edc;
        }
        .pastel-theme .number-box {
            background-color: #f0e1ff;
            color: #5e548e;
            border: 1px solid #b57edc;
        }
        .pastel-theme .number-box:hover {
            background-color: #c7b3e6;
            color: #fff;
        }
        .pastel-theme .number-box.selected {
            background-color: #ff66a4;
            color: #fff;
            transform: scale(1.05);
            box-shadow: 0 0 5px #ff66a4;
        }
        .pastel-theme .number-box.assigned {
            background-color: #e0e0e0;
            color: #a0a0a0;
        }
        .pastel-theme button {
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .pastel-theme #add-button { background-color: #b57edc; }
        .pastel-theme #add-button:hover { background-color: #a06ac9; }
        .pastel-theme #sorteo-button { background-color: #4a91f2; }
        .pastel-theme #sorteo-button:hover { background-color: #3b7ad6; }
        .pastel-theme #clear-button { background-color: #ff8c42; }
        .pastel-theme #clear-button:hover { background-color: #e67d35; }
        .pastel-theme .add-numbers-group button, .pastel-theme .range-buttons button { background-color: #72b9e6; }
        .pastel-theme .add-numbers-group button:hover, .pastel-theme .range-buttons button:hover { background-color: #61a9d4; }
        .pastel-theme #results-container, .pastel-theme #history-container {
            background-color: #fff8f8;
            border: 1px solid #b57edc;
        }
        .pastel-theme .person-entry, .pastel-theme .history-entry {
            border-bottom: 1px solid #e0c8ee;
        }
        .pastel-theme .person-name {
            color: #4a91f2;
        }
        .pastel-theme .action-button {
            color: #9381ff;
        }
        .pastel-theme .action-button:hover {
            color: #ff66a4;
        }
        .pastel-theme .edit-mode input[type="text"] {
            background-color: #fff0f3;
            color: #5e548e;
            border-color: #b57edc;
        }
        .pastel-theme .edit-mode .person-number-chip {
            background-color: #e0c8ee;
            color: #5e548e;
        }
        .pastel-theme .edit-mode .person-number-chip button {
            color: #ff66a4;
        }
        .pastel-theme .edit-mode #add-number-btn { background-color: #b57edc; color: #fff; }
        .pastel-theme .edit-mode #add-number-btn:hover { background-color: #a06ac9; }
        .pastel-theme .edit-mode #update-name-btn { background-color: #ff66a4; color: #fff; }
        .pastel-theme .edit-mode #update-name-btn:hover { background-color: #e65c92; }
        .pastel-theme #ganador-container h2 {
            color: #ff66a4;
        }
        .pastel-theme #ganador-nombre {
            color: #b57edc;
        }
        .pastel-theme #ganador-numero {
            color: #4a91f2;
        }
        .pastel-theme #countdown-timer {
            color: #ff8c42;
        }
        .pastel-theme #theme-selector {
            background-color: #fff0f3;
            color: #5e548e;
            border-color: #b57edc;
        }
        #theme-toggle-group {
            margin-top: 0;
            justify-content: flex-end;
        }
        #theme-selector {
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ccc;
            background-color: #fff;
            color: #333;
        }
        .cosmic-theme #theme-selector {
            background-color: #220044;
            color: #a0d4ff;
            border-color: #4b0082;
        }
        .neon-theme #theme-selector {
            background-color: #333344;
            color: #64ffda;
            border-color: #64ffda;
        }
        .pastel-theme #theme-selector {
            background-color: #fff8f8;
            color: #5e548e;
            border-color: #b57edc;
        }
        .hide-on-edit-mode {
            display: none;
        }
        /* ESTILOS PARA LOS BOTONES DE GUARDAR/CARGAR */
        #save-data-button { background-color: #6c757d; }
        #save-data-button:hover { background-color: #5a6268; }
        #load-data-button { background-color: #17a2b8; }
        #load-data-button:hover { background-color: #138496; }
        .cosmic-theme #save-data-button { background-color: #663399; }
        .cosmic-theme #save-data-button:hover { background-color: #5a2c8a; }
        .cosmic-theme #load-data-button { background-color: #00aaff; }
        .cosmic-theme #load-data-button:hover { background-color: #0077cc; }
        .neon-theme #save-data-button { background-color: #ff00ff; color: #000; }
        .neon-theme #save-data-button:hover { background-color: #cc00cc; }
        .neon-theme #load-data-button { background-color: #00ffff; color: #000; }
        .neon-theme #load-data-button:hover { background-color: #00cccc; }
        .pastel-theme #save-data-button { background-color: #b57edc; }
        .pastel-theme #save-data-button:hover { background-color: #a06ac9; }
        .pastel-theme #load-data-button { background-color: #72b9e6; }
        .pastel-theme #load-data-button:hover { background-color: #61a9d4; }
        
        #save-code-container {
            margin-top: 15px;
            padding: 10px;
            background-color: #eee;
            border: 1px solid #ccc;
            border-radius: 4px;
            display: none;
            word-break: break-all;
            text-align: center;
        }
        #save-code-container h4 {
            margin: 0;
            font-size: 1em;
            color: #555;
        }
        #saved-code {
            font-size: 1.5em;
            font-weight: bold;
            color: #007BFF;
            font-family: 'Courier New', monospace;
        }
        
        .cosmic-theme #save-code-container {
            background-color: #220044;
            border-color: #4b0082;
        }
        .cosmic-theme #save-code-container h4 {
            color: #b3a0d3;
        }
        .cosmic-theme #saved-code {
            color: #a0d4ff;
        }
        
        .neon-theme #save-code-container {
            background-color: #1a1a2a;
            border-color: #64ffda;
        }
        .neon-theme #save-code-container h4 {
            color: #f0f0f0;
        }
        .neon-theme #saved-code {
            color: #ff00ff;
        }
        
        .pastel-theme #save-code-container {
            background-color: #fff8f8;
            border-color: #b57edc;
        }
        .pastel-theme #save-code-container h4 {
            color: #5e548e;
        }
        .pastel-theme #saved-code {
            color: #b57edc;
        }
        /* --- NUEVO ESTILO PARA EL BORDE DE RESALTE --- */
        .number-box.resaltado {
            border: 3px solid #ff5722; /* Color naranja, puedes cambiarlo */
            transform: scale(1.1);
        }
        /* Fin de los nuevos estilos */
        .footer {
            text-align: center;
            margin-top: 20px;
            font-size: 0.9em;
            color: #888;
        }

        /* -------------------------------------- */
        /* --- ESTILOS TEMA HACKER (NUEVO) --- */
        /* -------------------------------------- */
        body.hacker-theme {
            background-color: #000000;
            color: #00ff00;
            font-family: 'Consolas', 'Courier New', monospace;
            overflow: hidden;
            position: relative;
        }

        /* Fondo de efecto "Matrix" */
        #hacker-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }
        #hacker-background::before {
            content: "10101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010-mode.person-info {
            display: none;
        }

        .hacker-theme #theme-selector {
            background-color: #0d1a0d;
            color: #00ff00;
            border-color: #00ff00;
        }

    </style>
</head>
<body>

<div id="hacker-background"></div>
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>

<div class="container" id="main-container">
    <div id="theme-toggle-group">
        <label for="theme-selector" style="font-weight: normal;">Seleccionar tema:</label>
        <select id="theme-selector">
            <option value="hacker">Hacker</option>
            <option value="pastel" selected>Pastel Dreams</option>
            <option value="default">Clásico</option>
            <option value="cosmic">Cosmic</option>
            <option value="neon">Neon Party</option>
        </select>
    </div>
    <div class="logo-container">
        <img src="logo.png" alt="Logo de Red Pilar" class="logo">
    </div>
    <h1>Red Pilar</h1>

    <div class="form-group">
        <label for="search-number">Buscar y resaltar número:</label>
        <input type="text" id="search-number" placeholder="Ej: 02, 102...">
    </div>

    <div class="form-group">
        <label for="person-name">Nombre de la persona:</label>
        <input type="text" id="person-name" placeholder="Escribe el nombre aquí...">
    </div>

    <label id="numbers-range-label">Selecciona los números (00 a 99):</label>
    <div id="numbers-container"></div>

    <label>Modificar cantidad de números:</label>
    <div class="add-numbers-group">
        <button id="add-10-button">+10</button>
        <button id="remove-10-button">-10</button>
    </div>
    <label>Selección de rango:</label>
    <div class="range-buttons">
        <button id="select-range-10-button">Seleccionar +10</button>
    </div>

    <div class="button-group">
        <button id="add-button">Agregar persona y números</button>
        <button id="sorteo-button">Sortear</button>
    </div>

    <div style="display: flex; justify-content: flex-end; margin-top: 10px;">
        <button id="clear-button" style="width: 48%;">Limpiar todo</button>
    </div>

    <hr>
    
    <div style="text-align: center; margin-top: 20px;">
        <button id="save-data-button" style="padding: 10px 20px; border: none; border-radius: 4px; color: #fff; cursor: pointer;">Guardar Sorteo</button>
        <input type="text" id="load-code-input" placeholder="Ingresa tu código" style="padding: 10px; border-radius: 4px; border: 1px solid #ccc; width: 150px;">
        <button id="load-data-button" style="padding: 10px 20px; border: none; border-radius: 4px; color: #fff; cursor: pointer;">Cargar Sorteo</button>
    </div>
    
    <div id="save-code-container">
        <h4>Tu sorteo ha sido guardado.</h4>
        <p>¡Guarda este código para cargarlo en otro momento! 👉 <span id="saved-code"></span></p>
    </div>

    <hr>

    <div id="results-container">
        <h2>Participantes</h2>
        <div class="form-group">
            <input type="text" id="search-person" placeholder="Busca por nombre o número...">
        </div>
        <div id="results-list">
        </div>
    </div>

    <div id="ganador-container" style="display:none;">
        <div id="countdown-timer"></div>
        <h2>¡El número ganador es!</h2>
        <div id="ganador-numero"></div>
        <h2>¡Y el ganador es!</h2>
        <div id="ganador-nombre"></div>
    </div>
    <div class="footer">
        design by Clau
    </div>

</div>

<script>
    const firebaseConfig = {
      apiKey: "AIzaSyCQdtjwagG3pH2_MZAV2pKVq9HS7I-ufHk",
      authDomain: "sorteo-24534.firebaseapp.com",
      projectId: "sorteo-24534",
      storageBucket: "sorteo-24534.firebasestorage.app",
      messagingSenderId: "546018107328",
      appId: "1:546018107328:web:4eb823a41e3cd70c29f225"
    };

    // Inicializa Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const numbersContainer = document.getElementById('numbers-container');
    const personNameInput = document.getElementById('person-name');
    const addButton = document.getElementById('add-button');
    const clearButton = document.getElementById('clear-button');
    const sorteoButton = document.getElementById('sorteo-button');
    const add10Button = document.getElementById('add-10-button');
    const remove10Button = document.getElementById('remove-10-button');
    const selectRange10Button = document.getElementById('select-range-10-button');
    const resultsList = document.getElementById('results-list');
    const ganadorContainer = document.getElementById('ganador-container');
    const ganadorNumero = document.getElementById('ganador-numero');
    const ganadorNombre = document.getElementById('ganador-nombre');
    const countdownTimer = document.getElementById('countdown-timer');
    const themeSelector = document.getElementById('theme-selector');
    const body = document.body;
    const mainContainer = document.getElementById('main-container');
    const numbersRangeLabel = document.getElementById('numbers-range-label');
    const hackerBackground = document.getElementById('hacker-background');

    const saveButton = document.getElementById('save-data-button');
    const loadButton = document.getElementById('load-data-button');
    const loadCodeInput = document.getElementById('load-code-input');
    const saveCodeContainer = document.getElementById('save-code-container');
    const savedCodeElement = document.getElementById('saved-code');
    
    // Campo de búsqueda de números
    const searchNumberInput = document.getElementById('search-number');
    // Nuevo campo de búsqueda de participantes
    const searchPersonInput = document.getElementById('search-person');


    const countdownSound = new Audio('https://www.soundboard.com/mediafiles/3/30018_e2f694931a78c1874249a567634f195d.mp3');
    const spinSound = new Audio('https://www.soundboard.com/mediafiles/1/18167_nfs_prostreet_rev_4.mp3');
    const winnerSound = new Audio('https://www.soundboard.com/mediafiles/6/6389_87900b90e9e46a78280f58a329d91f86.mp3');

    let selectedNumbers = [];
    let allParticipants = [];
    let assignedNumbers = new Set();
    const MIN_NUMBERS = 100;
    let currentMaxNumber = 99;
    let currentRaffleCode = null; // Variable para almacenar el código del sorteo cargado
    
    let hackerEffectInterval;

    loadData();

    function updateRangeLabel() {
        numbersRangeLabel.textContent = `Selecciona los números (00 a ${currentMaxNumber}):`;
    }

    function createNumberBox(number) {
        const numberBox = document.createElement('div');
        numberBox.classList.add('number-box');
        numberBox.textContent = String(number).padStart(2, '0');
        numberBox.dataset.number = number;
        numbersContainer.appendChild(numberBox);

        numberBox.addEventListener('click', () => {
            if (!numberBox.classList.contains('assigned')) {
                numberBox.classList.toggle('selected');
                const num = parseInt(numberBox.dataset.number);
                const index = selectedNumbers.indexOf(num);
                if (index > -1) {
                    selectedNumbers.splice(index, 1);
                } else {
                    selectedNumbers.push(num);
                }
            }
        });
    }

    function generateNumberBoxes(limit) {
        numbersContainer.innerHTML = '';
        for (let i = 0; i <= limit; i++) {
            createNumberBox(i);
        }
    }

    function markAssignedNumbers() {
        const numberBoxes = document.querySelectorAll('.number-box');
        numberBoxes.forEach(box => {
            const num = parseInt(box.dataset.number);
            if (assignedNumbers.has(num)) {
                box.classList.add('assigned');
                box.classList.remove('selected');
            } else {
                box.classList.remove('assigned');
            }
        });
    }

    function addPerson() {
        const name = personNameInput.value.trim();
        if (name === '') {
            alert('Por favor, ingresa un nombre.');
            return;
        }

        if (selectedNumbers.length === 0) {
            alert('Por favor, selecciona al menos un número.');
            return;
        }

        const numbersToAssign = [];
        for (const num of selectedNumbers) {
            if (!assignedNumbers.has(num)) {
                numbersToAssign.push(num);
                assignedNumbers.add(num);
            }
        }

        if (numbersToAssign.length === 0) {
            alert('Todos los números seleccionados ya están asignados.');
            return;
        }

        const person = {
            id: Date.now(),
            name: name,
            numbers: numbersToAssign,
        };

        allParticipants.push(person);
        selectedNumbers = [];
        personNameInput.value = '';
        markAssignedNumbers();
        renderParticipants(allParticipants);
    }

    function renderParticipants(participants) {
        resultsList.innerHTML = '';
        participants.forEach(person => {
            const entry = document.createElement('div');
            entry.classList.add('person-entry');
            entry.dataset.id = person.id;
            entry.innerHTML = `
                <div class="person-info">
                    <div class="person-name">${person.name}</div>
                    <div class="person-numbers">${person.numbers.join(', ')}</div>
                </div>
                <div class="person-actions">
                    <button class="action-button edit-button">✏️</button>
                    <button class="action-button delete-button">🗑️</button>
                </div>
            `;
            resultsList.appendChild(entry);
        });

        addEventListenersToButtons();
    }

    function addEventListenersToButtons() {
        document.querySelectorAll('.edit-button').forEach(button => {
            button.addEventListener('click', (e) => {
                const entry = e.target.closest('.person-entry');
                const id = parseInt(entry.dataset.id);
                editPerson(id);
            });
        });

        document.querySelectorAll('.delete-button').forEach(button => {
            button.addEventListener('click', (e) => {
                const entry = e.target.closest('.person-entry');
                const id = parseInt(entry.dataset.id);
                deletePerson(id);
            });
        });
    }

    function editPerson(id) {
        const person = allParticipants.find(p => p.id === id);
        if (!person) return;

        const entry = document.querySelector(`.person-entry[data-id="${id}"]`);
        entry.classList.add('edit-mode');

        const oldName = person.name;
        const oldNumbers = person.numbers;

        entry.innerHTML = `
            <div class="person-info">
                <input type="text" id="edit-name-${id}" value="${oldName}" placeholder="Nuevo nombre...">
                <div class="person-numbers-list" id="edit-numbers-${id}"></div>
                <div class="form-group" style="margin-top: 10px;">
                    <input type="text" id="add-number-input-${id}" placeholder="Número para añadir (Ej: 42)">
                </div>
                <button id="add-number-btn-${id}" class="edit-mode-btn" style="background-color: #007BFF; color: #fff;">Añadir</button>
            </div>
            <div class="person-actions">
                <button id="update-name-btn-${id}" class="edit-mode-btn" style="background-color: #4CAF50; color: #fff;">Guardar</button>
                <button id="cancel-edit-btn-${id}" class="edit-mode-btn" style="background-color: #f44336; color: #fff;">Cancelar</button>
            </div>
        `;
        
        const numbersList = document.getElementById(`edit-numbers-${id}`);
        oldNumbers.forEach(num => {
            const chip = createNumberChip(num, id);
            numbersList.appendChild(chip);
        });

        document.getElementById(`update-name-btn-${id}`).addEventListener('click', () => saveEdit(id));
        document.getElementById(`cancel-edit-btn-${id}`).addEventListener('click', () => cancelEdit(id));
        document.getElementById(`add-number-btn-${id}`).addEventListener('click', () => addNumberToPerson(id));
    }

    function createNumberChip(number, personId) {
        const chip = document.createElement('span');
        chip.classList.add('person-number-chip');
        chip.textContent = String(number).padStart(2, '0');
        chip.dataset.number = number;

        const removeBtn = document.createElement('button');
        removeBtn.textContent = 'x';
        removeBtn.addEventListener('click', () => removeNumberFromPerson(personId, number));

        chip.appendChild(removeBtn);
        return chip;
    }

    function removeNumberFromPerson(personId, number) {
        const person = allParticipants.find(p => p.id === personId);
        if (!person) return;

        person.numbers = person.numbers.filter(num => num !== number);
        assignedNumbers.delete(number);

        renderParticipants(allParticipants);
        markAssignedNumbers();
    }

    function addNumberToPerson(personId) {
        const input = document.getElementById(`add-number-input-${personId}`);
        const newNumber = parseInt(input.value.trim());

        if (isNaN(newNumber) || newNumber < 0 || newNumber > currentMaxNumber) {
            alert(`Por favor, introduce un número válido entre 0 y ${currentMaxNumber}.`);
            return;
        }

        if (assignedNumbers.has(newNumber)) {
            alert('Este número ya está asignado.');
            return;
        }

        const person = allParticipants.find(p => p.id === personId);
        if (person) {
            person.numbers.push(newNumber);
            assignedNumbers.add(newNumber);
            
            const numbersList = document.getElementById(`edit-numbers-${personId}`);
            const chip = createNumberChip(newNumber, personId);
            numbersList.appendChild(chip);
            
            input.value = '';
            markAssignedNumbers();
        }
    }

    function saveEdit(id) {
        const person = allParticipants.find(p => p.id === id);
        if (!person) return;

        const newNameInput = document.getElementById(`edit-name-${id}`);
        person.name = newNameInput.value.trim() || person.name;

        renderParticipants(allParticipants);
        markAssignedNumbers();
    }

    function cancelEdit(id) {
        renderParticipants(allParticipants);
    }

    function deletePerson(id) {
        if (!confirm('¿Estás seguro de que quieres eliminar a esta persona y sus números?')) {
            return;
        }
        const person = allParticipants.find(p => p.id === id);
        if (!person) return;

        person.numbers.forEach(num => assignedNumbers.delete(num));
        allParticipants = allParticipants.filter(p => p.id !== id);

        renderParticipants(allParticipants);
        markAssignedNumbers();
    }

    function clearAll() {
        if (confirm('¿Estás seguro de que quieres limpiar todos los participantes y números?')) {
            allParticipants = [];
            selectedNumbers = [];
            assignedNumbers.clear();
            personNameInput.value = '';
            ganadorContainer.style.display = 'none';
            renderParticipants([]);
            markAssignedNumbers();
        }
    }

    function sorteo() {
        const allNumbers = allParticipants.flatMap(p => p.numbers);
        if (allNumbers.length === 0) {
            alert('No hay números disponibles para el sorteo.');
            return;
        }

        ganadorContainer.style.display = 'block';
        ganadorNumero.textContent = '';
        ganadorNombre.textContent = '';
        sorteoButton.disabled = true;

        const totalTime = 3000;
        const interval = 50;
        let elapsed = 0;
        let countdown = 3;
        
        countdownTimer.textContent = '3';
        countdownSound.currentTime = 0;
        countdownSound.play();
        
        const countdownInterval = setInterval(() => {
            countdown--;
            if (countdown > 0) {
                countdownTimer.textContent = countdown;
                countdownSound.currentTime = 0;
                countdownSound.play();
            } else {
                clearInterval(countdownInterval);
                countdownTimer.textContent = '';
                spinSound.play();
                spinSound.loop = true;
                
                const sorteoInterval = setInterval(() => {
                    elapsed += interval;
                    const randomIndex = Math.floor(Math.random() * allNumbers.length);
                    const randomWinnerNumber = allNumbers[randomIndex];
                    ganadorNumero.textContent = String(randomWinnerNumber).padStart(2, '0');
                    if (elapsed >= totalTime) {
                        clearInterval(sorteoInterval);
                        spinSound.pause();
                        spinSound.currentTime = 0;
                        spinSound.loop = false;
                        
                        const winnerNumber = parseInt(ganadorNumero.textContent);
                        const winner = allParticipants.find(p => p.numbers.includes(winnerNumber));
                        ganadorNombre.textContent = winner ? winner.name : 'No encontrado';
                        ganadorNumero.classList.add('ganador-zoom');
                        ganadorNombre.classList.add('ganador-zoom');
                        
                        setTimeout(() => {
                            winnerSound.play();
                            createConfetti(50);
                            sorteoButton.disabled = false;
                        }, 500);

                    }
                }, interval);
            }
        }, 1000);
    }

    function createConfetti(count) {
        for (let i = 0; i < count; i++) {
            const confetti = document.createElement('div');
            confetti.classList.add('confetti');
            confetti.style.left = `${Math.random() * 100}%`;
            confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
            confetti.style.animationDuration = `${Math.random() * 2 + 3}s`;
            ganadorContainer.appendChild(confetti);
        }
    }

    function addRemoveNumbers(count) {
        currentMaxNumber += count;
        if (currentMaxNumber < MIN_NUMBERS - 1) {
            currentMaxNumber = MIN_NUMBERS - 1;
        }
        generateNumberBoxes(currentMaxNumber);
        markAssignedNumbers();
        updateRangeLabel();
    }
    
    function selectRangeOfNumbers(count) {
        const startNumber = selectedNumbers.length > 0 ? Math.max(...selectedNumbers) + 1 : 0;
        
        const newlySelected = [];
        for (let i = 0; i < count; i++) {
            const num = startNumber + i;
            if (num > currentMaxNumber) {
                alert('No hay suficientes números disponibles para seleccionar en este rango.');
                break;
            }
            if (!assignedNumbers.has(num)) {
                newlySelected.push(num);
            }
        }
        
        selectedNumbers = [...selectedNumbers, ...newlySelected];
        selectedNumbers.sort((a,b) => a-b);
        
        document.querySelectorAll('.number-box').forEach(box => {
            const num = parseInt(box.dataset.number);
            if (selectedNumbers.includes(num)) {
                box.classList.add('selected');
            } else {
                box.classList.remove('selected');
            }
        });
    }

    function loadTheme(theme) {
        body.classList.remove('cosmic-theme', 'neon-theme', 'pastel-theme', 'hacker-theme');
        mainContainer.classList.remove('cosmic-theme', 'neon-theme', 'pastel-theme', 'hacker-theme');
        
        stopHackerEffect();
        if (theme === 'hacker') {
            body.classList.add('hacker-theme');
            mainContainer.classList.add('hacker-theme');
            loadHackerEffect();
        } else if (theme !== 'default') {
            body.classList.add(`${theme}-theme`);
            mainContainer.classList.add(`${theme}-theme`);
        }
    }

    function loadHackerEffect() {
        const chars = '0123456789ABCDEF!@#$%^&*()_+{}[]|:;"<>,.?/~`';
        const numChars = chars.length;
        const columnWidth = 10;
        const totalColumns = Math.floor(window.innerWidth / columnWidth);

        const columns = [];
        for (let i = 0; i < totalColumns; i++) {
            columns.push({
                x: i * columnWidth,
                y: Math.random() * -window.innerHeight,
                speed: Math.random() * 5 + 3,
                length: Math.random() * 20 + 10
            });
        }
        
        hackerBackground.style.display = 'block';

        hackerEffectInterval = setInterval(() => {
            hackerBackground.innerHTML = '';
            columns.forEach(col => {
                let currentY = col.y;
                for (let i = 0; i < col.length; i++) {
                    const char = document.createElement('span');
                    char.textContent = chars[Math.floor(Math.random() * numChars)];
                    char.style.position = 'absolute';
                    char.style.left = `${col.x}px`;
                    char.style.top = `${currentY}px`;
                    char.style.color = `#00ff00`;
                    char.style.fontSize = `12px`;
                    char.style.opacity = (col.length - i) / col.length;
                    hackerBackground.appendChild(char);
                    currentY += 12; // Altura de la fuente
                }
                
                col.y += col.speed;
                if (col.y > window.innerHeight) {
                    col.y = Math.random() * -window.innerHeight;
                    col.speed = Math.random() * 5 + 3;
                    col.length = Math.random() * 20 + 10;
                }
            });
        }, 50);
    }
    
    function stopHackerEffect() {
        clearInterval(hackerEffectInterval);
        hackerBackground.innerHTML = '';
        hackerBackground.style.display = 'none';
    }

    function saveData() {
        const raffleData = {
            participants: allParticipants,
            assignedNumbers: Array.from(assignedNumbers),
            maxNumber: currentMaxNumber
        };
        const dataString = JSON.stringify(raffleData);
        const raffleCode = btoa(dataString);
        
        db.collection("raffles").add({
            code: raffleCode,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
        })
        .then((docRef) => {
            savedCodeElement.textContent = docRef.id;
            saveCodeContainer.style.display = 'block';
            console.log("Documento escrito con ID: ", docRef.id);
        })
        .catch((error) => {
            alert("Error al guardar el sorteo: " + error);
        });
    }
    
    function loadData() {
        const code = loadCodeInput.value.trim();
        if (code === '') {
            return;
        }
        
        db.collection("raffles").doc(code).get()
        .then((doc) => {
            if (doc.exists) {
                const data = doc.data();
                if (data && data.code) {
                    try {
                        const dataString = atob(data.code);
                        const raffleData = JSON.parse(dataString);
                        allParticipants = raffleData.participants;
                        assignedNumbers = new Set(raffleData.assignedNumbers);
                        currentMaxNumber = raffleData.maxNumber;
                        generateNumberBoxes(currentMaxNumber);
                        markAssignedNumbers();
                        renderParticipants(allParticipants);
                        updateRangeLabel();
                        alert("Sorteo cargado exitosamente.");
                        currentRaffleCode = code;
                    } catch (e) {
                        alert("Código de sorteo no válido.");
                    }
                }
            } else {
                alert("No se encontró un sorteo con ese código.");
            }
        })
        .catch((error) => {
            alert("Error al cargar el sorteo: " + error);
        });
    }

    // Funcionalidad de búsqueda de números
    searchNumberInput.addEventListener('input', (e) => {
        const searchTerm = e.target.value.trim();
        const numberBoxes = document.querySelectorAll('.number-box');
        
        numberBoxes.forEach(box => {
            box.classList.remove('resaltado');
            if (searchTerm !== '' && box.textContent.includes(searchTerm)) {
                box.classList.add('resaltado');
            }
        });
    });

    // Funcionalidad de búsqueda de participantes
    searchPersonInput.addEventListener('input', (e) => {
        const searchTerm = e.target.value.trim().toLowerCase();
        let filteredParticipants = [];

        if (searchTerm === '') {
            filteredParticipants = allParticipants;
        } else {
            filteredParticipants = allParticipants.filter(person => {
                // Buscar por nombre
                const nameMatch = person.name.toLowerCase().includes(searchTerm);
                // Buscar por número asignado
                const numberMatch = person.numbers.some(num => String(num).padStart(2, '0').includes(searchTerm));
                return nameMatch || numberMatch;
            });
        }
        renderParticipants(filteredParticipants);
    });

    // Inicialización
    generateNumberBoxes(currentMaxNumber);
    updateRangeLabel();

    // Event Listeners
    addButton.addEventListener('click', addPerson);
    clearButton.addEventListener('click', clearAll);
    sorteoButton.addEventListener('click', sorteo);
    add10Button.addEventListener('click', () => addRemoveNumbers(10));
    remove10Button.addEventListener('click', () => addRemoveNumbers(-10));
    selectRange10Button.addEventListener('click', () => selectRangeOfNumbers(10));
    themeSelector.addEventListener('change', (e) => {
        loadTheme(e.target.value);
    });

    saveButton.addEventListener('click', saveData);
    loadButton.addEventListener('click', loadData);

    // Cargar el tema inicial por defecto
    loadTheme(themeSelector.value);

</script>

</body>
</html>
